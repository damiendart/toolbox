# This file was written by Damien Dart, <damiendart@pobox.com>. This is
# free and unencumbered software released into the public domain. For
# more information, please refer to the accompanying "UNLICENCE file.
---

version: '3'

output: 'prefixed'

tasks:
  default:
    deps:
      - task: 'ci'

  ci:
    cmds:
      - task: 'dependencies'
      - task: 'lint'
    desc: 'Run all CI-related tasks'

  dependencies:
    cmds:
      # ShellCheck is required for linting shell-related files and
      # currently must be installed manually.
      - 'pip3 install -r requirements.txt'
    desc: 'Install Python dependencies'

  lint:
    cmds:
      - task: 'lint:python'
      - task: 'lint:shell'
    desc: 'Run all linting-related tasks'

  lint:python:
    cmds:
      - task: 'lint:python:black'
      - task: 'lint:python:flake8'
    desc: 'Run all Python linting tasks'

  lint:python:black:
    cmds:
      - 'black --check install bin/markdown-tidy'
    desc: 'Lint Python scripts with Black'

  lint:python:flake8:
    cmds:
      - 'flake8 install bin/markdown-tidy'
    desc: 'Lint Python scripts with Flake8'

  lint:shell:
    cmds:
      - 'shellcheck .bash_profile .bashrc .profile .shellrc bin/pinboardbackup bin/fuzzy-snippets'
    desc: 'Lint shell configuration files and scripts with ShellCheck'
